{"version":3,"file":"attestation.fetch.js","sources":["../src/attestation.fetch.ts"],"sourcesContent":["import { DEFAULT_FETCH_OPTIONS } from './constants.js';\nimport { isValidResponse } from './errors.js';\nimport { EncodedAttestationCredential } from './attestation.encoder.js';\n\n/**\n * The `DEFAULT_ATTESTATION_OPTIONS` variable defines the default configuration\n * options for attestation during the authentication process.\n *\n * Properties:\n * - `attestationType`: Specifies the type of attestation. Defaults to 'none'.\n * - `authenticatorSelection`: Describes the settings for the authenticator to be used.\n *   - `authenticatorAttachment`: Defines whether the authenticator is platform-bound or not. Defaults to 'platform'.\n *   - `userVerification`: Indicates the requirement for user verification. Defaults to 'required'.\n *   - `requireResidentKey`: Determines whether the creation of a resident key is required. Defaults to false.\n * - `extensions`: Includes additional, optional WebAuthn extension settings.\n *   - `liquid`: A custom extension enabled by default with a value of true.\n *\n * @internal\n */\nexport const DEFAULT_ATTESTATION_OPTIONS = {\n  attestationType: 'none',\n  authenticatorSelection: {\n    authenticatorAttachment: 'platform',\n    userVerification: 'required',\n    requireResidentKey: false,\n  },\n  extensions: {\n    liquid: true,\n  },\n};\n\n/**\n * Fetches an attestation request from the specified origin with the provided options.\n *\n * @param {string} origin - The URL of the origin from which the attestation request will be fetched.\n * @param {object} [options=DEFAULT_ATTESTATION_OPTIONS] - The options to include in the attestation request payload. Defaults to `DEFAULT_ATTESTATION_OPTIONS`.\n * @return {Promise<Response>} A promise that resolves to the response of the fetch request.\n * @todo: Generate Typed JSON-RPC clients from Swagger/OpenAPI\n */\nexport async function postOptions(\n  origin: string,\n  options = DEFAULT_ATTESTATION_OPTIONS,\n) {\n  return await fetch(`${origin}/attestation/request`, {\n    ...DEFAULT_FETCH_OPTIONS,\n    body: JSON.stringify(options),\n  }).then((r) => {\n    if (!isValidResponse(r)) throw new Error(r.statusText);\n    return r.json();\n  });\n}\n\n/**\n * Fetch interface for Attestation Response\n *\n * @param origin\n * @param credential\n * @todo: Generate Typed JSON-RPC clients from Swagger/OpenAPI\n */\nexport async function postResponse(\n  origin: string,\n  credential: EncodedAttestationCredential,\n) {\n  return await fetch(`${origin}/attestation/response`, {\n    ...DEFAULT_FETCH_OPTIONS,\n    body: JSON.stringify(credential),\n  }).then((r) => {\n    if (!isValidResponse(r)) throw new Error(r.statusText);\n    return r.json();\n  });\n}\n"],"names":[],"mappings":";;AAmBO,MAAM,8BAA8B;AAAA,EACzC,iBAAiB;AAAA,EACjB,wBAAwB;AAAA,IACtB,yBAAyB;AAAA,IACzB,kBAAkB;AAAA,IAClB,oBAAoB;AAAA,EACtB;AAAA,EACA,YAAY;AAAA,IACV,QAAQ;AAAA,EAAA;AAEZ;AAUsB,eAAA,YACpB,QACA,UAAU,6BACV;AACA,SAAO,MAAM,MAAM,GAAG,MAAM,wBAAwB;AAAA,IAClD,GAAG;AAAA,IACH,MAAM,KAAK,UAAU,OAAO;AAAA,EAAA,CAC7B,EAAE,KAAK,CAAC,MAAM;AACT,QAAA,CAAC,gBAAgB,CAAC,SAAS,IAAI,MAAM,EAAE,UAAU;AACrD,WAAO,EAAE,KAAK;AAAA,EAAA,CACf;AACH;AASsB,eAAA,aACpB,QACA,YACA;AACA,SAAO,MAAM,MAAM,GAAG,MAAM,yBAAyB;AAAA,IACnD,GAAG;AAAA,IACH,MAAM,KAAK,UAAU,UAAU;AAAA,EAAA,CAChC,EAAE,KAAK,CAAC,MAAM;AACT,QAAA,CAAC,gBAAgB,CAAC,SAAS,IAAI,MAAM,EAAE,UAAU;AACrD,WAAO,EAAE,KAAK;AAAA,EAAA,CACf;AACH;"}