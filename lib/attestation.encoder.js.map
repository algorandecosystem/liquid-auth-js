{"version":3,"file":"attestation.encoder.js","sources":["../src/attestation.encoder.ts"],"sourcesContent":["import { decodeAddress, fromBase64Url, toBase64URL } from './encoding.js';\n\n/**\n * This interface represents the encoded authenticator attestation response\n * typically used in WebAuthn during a registration ceremony. It contains\n * properties that capture the client and attestation data returned by\n * the authenticator, along with optional user and signature information.\n *\n * Properties:\n * - clientDataJSON: A string containing the JSON serialized client data collected during the operation.\n * - attestationObject: A string containing the base64url encoded attestation object generated by the authenticator.\n * - signature: An optional string representing the signature generated by the authenticator for this response.\n * - userHandle: An optional string containing the user handle associated with the credentials being registered.\n * - [k: string]: A utility to define additional optional properties as a key-value pair where the key is a string, and the value is either a string or undefined.\n *\n * @protected\n */\nexport interface EncodedAuthenticatorAttestationResponse {\n  [k: string]: string | undefined;\n\n  /**\n   * A string representing the JSON-encoded client data associated with a web authentication operation.\n   * This property typically contains information about the client, such as the type of operation\n   * (e.g., \"webauthn.create\" or \"webauthn.get\"), challenge data, and other contextual metadata.\n   * It is used as part of the Web Authentication API for validation and security purposes.\n   */\n  clientDataJSON: string;\n  /**\n   * Represents the attestation object used in Web Authentication (WebAuthn) operations.\n   * The attestation object is a base64url-encoded string containing authentication metadata.\n   * It is generated during the creation of a WebAuthn credential and used to verify\n   * the authenticity and origin of the credential.\n   *\n   * Typically, the attestation object includes details such as:\n   * - Information about the authenticator device.\n   * - Relevant cryptographic signatures.\n   * - Attestation format identifier and other metadata.\n   *\n   * This string is crucial for validating the generated credential's trustworthiness\n   * and ensuring secure communication between the relying party and the authenticator.\n   */\n  attestationObject: string;\n  /**\n   * An optional string property that may contain a signature.\n   */\n  signature?: string;\n  /**\n   * Represents the unique identifier or handle of a user.\n   * This is typically used to reference or display a user's identity\n   * within a system where handles or usernames are required.\n   * This property is optional and may not always be provided.\n   */\n  userHandle?: string;\n}\n\n/**\n * EncodedAttestationCredential represents an interface for a credential object\n * used in attestation within a Web Authentication API process. It includes\n * essential properties and can also have additional key-value pairs.\n *\n * Properties:\n * - `id`: A string representing the identifier of the credential.\n * - `type`: A string indicating the type of the credential, typically \"public-key\".\n * - `response`: An object of EncodedAuthenticatorAttestationResponse type which\n *   contains encoded attestation response data.\n * - `rawId`: A string containing the base64url-encoded representation of the\n *   credential's raw identifier.\n * - `[k: string]`: Allows for additional properties, which can be strings or of\n *   the EncodedAuthenticatorAttestationResponse type.\n *\n * @protected\n */\nexport interface EncodedAttestationCredential {\n  [k: string]: string | EncodedAuthenticatorAttestationResponse;\n\n  /**\n   * Represents a unique identifier as a string.\n   * This identifier is typically used to denote a single distinct entity\n   * within a given system or context.\n   */\n  id: string;\n  /**\n   * Represents a variable of string type.\n   * Used to store textual data.\n   */\n  type: string;\n  /**\n   * Represents the attestation response from a WebAuthn authenticator after a\n   * registration ceremony using the PublicKeyCredential.create() method.\n   * The `response` contains the encoded information necessary to validate\n   * and finalize the registration of the credential.\n   */\n  response: EncodedAuthenticatorAttestationResponse;\n  /**\n   * Represents the unique identifier in its raw format.\n   * Commonly used for internal processing or as a reference to entities in systems.\n   * This value should be treated as opaque and not human-readable.\n   */\n  rawId: string;\n}\n\n/**\n * Encodes the given attestation credential into a structured format.\n *\n * @param {PublicKeyCredential} credential - The credential object to be encoded,\n * typically obtained during the registration phase of WebAuthn.\n * @return An object containing the encoded credential information,\n * including its ID, type, and response fields in base64 URL format.\n */\nexport function encodeCredential(\n  credential: PublicKeyCredential,\n): EncodedAttestationCredential {\n  const response = credential.response as AuthenticatorAttestationResponse;\n  return {\n    id: credential.id,\n    rawId: toBase64URL(credential.rawId),\n    type: credential.type,\n    response: {\n      clientDataJSON: toBase64URL(response.clientDataJSON),\n      attestationObject: toBase64URL(response.attestationObject),\n    },\n  };\n}\n\n/**\n * Decodes and processes the attestation options with additional address and challenge decoding.\n *\n * @param {Object} options - The original attestation options, including user and credentials information.\n * @param {Object} liquidOptions - Contains additional data such as the address used for decoding.\n * @return Returns the updated attestation options with decoded user address, display name, and challenge.\n */\nexport function decodeOptions(options: any, liquidOptions: any) {\n  const attestationOptions = { ...options };\n  attestationOptions.user.id = decodeAddress(liquidOptions.address);\n  attestationOptions.user.name = liquidOptions.address;\n  attestationOptions.user.displayName = liquidOptions.address;\n  attestationOptions.challenge = fromBase64Url(options.challenge);\n\n  if (attestationOptions.excludeCredentials) {\n    for (const cred of attestationOptions.excludeCredentials) {\n      cred.id = fromBase64Url(cred.id);\n    }\n  }\n\n  return attestationOptions;\n}\n"],"names":[],"mappings":";AA6GO,SAAS,iBACd,YAC8B;AAC9B,QAAM,WAAW,WAAW;AAC5B,SAAO;AAAA,IACL,IAAI,WAAW;AAAA,IACf,OAAO,YAAY,WAAW,KAAK;AAAA,IACnC,MAAM,WAAW;AAAA,IACjB,UAAU;AAAA,MACR,gBAAgB,YAAY,SAAS,cAAc;AAAA,MACnD,mBAAmB,YAAY,SAAS,iBAAiB;AAAA,IAAA;AAAA,EAC3D;AAEJ;AASO,SAAS,cAAc,SAAc,eAAoB;AAC9D,QAAM,qBAAqB,EAAE,GAAG,QAAA;AAChC,qBAAmB,KAAK,KAAK,cAAc,cAAc,OAAO;AAChE,qBAAmB,KAAK,OAAO,cAAc;AAC7C,qBAAmB,KAAK,cAAc,cAAc;AACpD,qBAAmB,YAAY,cAAc,QAAQ,SAAS;AAE9D,MAAI,mBAAmB,oBAAoB;AACzC,eAAW,QAAQ,mBAAmB,oBAAoB;AACxD,WAAK,KAAK,cAAc,KAAK,EAAE;AAAA,IACjC;AAAA,EACF;AAEA,SAAO;AACT;"}