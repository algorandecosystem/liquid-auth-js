{"version":3,"file":"assertion.js","sources":["../src/assertion.ts"],"sourcesContent":["/**\n * This module is only for use within the browser.\n *\n * @packageDocumentation\n * @document ./assertion.guide.md\n */\nimport { postOptions, postResponse } from './assertion.fetch.js';\nimport { decodeOptions, encodeCredential } from './assertion.encoder.js';\nimport {\n  AUTHENTICATOR_NOT_SUPPORTED_MESSAGE,\n  INVALID_INPUT_MESSAGE,\n} from './errors.js';\n\nexport * as fetch from './assertion.fetch.js';\nexport * as encoder from './assertion.encoder.js';\n\n/**\n * Represents the options for an assertion used during authentication.\n */\nexport type AssertionOptions = {\n  /**\n   * Represents the origin service to which a request should be sent.\n   */\n  origin: string;\n  /**\n   * Represents the unique identifier for a credential.\n   * This variable identifies a specific credential within the authenticator.\n   */\n  credId: string;\n  /**\n   * An optional configuration object that specifies options for a PublicKeyCredential request.\n   *\n   * This object is used during the process of requesting a credential from the user's device\n   * for Web Authentication (WebAuthn). It allows customization of the request to match\n   * the application's authentication requirements.\n   *\n   * Property details of `PublicKeyCredentialRequestOptions` typically include:\n   * - `timeout`: The time, in milliseconds, that the user agent is expected to wait for a response.\n   * - `userVerification`: Specifies the level of user verification required (e.g., \"required\", \"preferred\", \"discouraged\").\n   *\n   * This parameter is optional when calling authentication-related functions. If omitted,\n   * the request may rely on default or previously established options.\n   */\n  options?: PublicKeyCredentialRequestOptions;\n  /**\n   * A boolean flag to enable or disable debug mode.\n   * If set to `true`, the application may output additional\n   * logging or diagnostic information useful for debugging.\n   * Defaults to `false` if not specified.\n   */\n  debug?: boolean;\n};\n/**\n * Assert a known credential\n *\n * Handles both {@link fetch.postOptions} and {@link fetch.postResponse} for the caller.\n * This includes encoding/decoding the payloads from the service and navigator api.\n *\n * #### Quick Start:\n * {@includeCode ./assertion.spec.ts#assertionImport,quickStart}\n *\n *\n * @param {AssertionOptions} params\n */\nexport async function assertion(params: AssertionOptions) {\n  if (typeof navigator === 'undefined')\n    throw new Error(AUTHENTICATOR_NOT_SUPPORTED_MESSAGE);\n  if (typeof params === 'undefined') throw new Error(INVALID_INPUT_MESSAGE);\n  const { origin, credId, options, debug } = params;\n  if (typeof credId !== 'string' || typeof origin !== 'string') {\n    throw new TypeError(INVALID_INPUT_MESSAGE);\n  }\n  debug &&\n    console.log(\n      `%cFETCHING: %c/assertion/request/${credId}`,\n      'color: yellow',\n      'color: cyan',\n    );\n\n  // Use the passed-in options or fetch the options from the server\n  const credentialOptions =\n    typeof options !== 'undefined'\n      ? options // TODO: validate options\n      : await postOptions(origin, credId).then(decodeOptions);\n\n  if (credentialOptions.allowCredentials?.length === 0) {\n    debug && console.info('No registered credentials found.');\n    return null;\n  }\n\n  debug &&\n    console.log(\n      '%cGET_CREDENTIAL:%c navigator.credentials.get',\n      'color: yellow',\n      'color: cyan',\n      options,\n    );\n\n  // Retrieve the credential from the Credential api\n  const credential = await navigator.credentials\n    .get({\n      publicKey: credentialOptions,\n    })\n    // Encode the credential for submitting to the service\n    .then(encodeCredential);\n\n  debug &&\n    console.log(\n      '%cPOSTING: %c/assertion/response',\n      'color: yellow',\n      'color: cyan',\n      credential,\n    );\n\n  // Send the credential to the service\n  return postResponse(origin, credential);\n}\n"],"names":[],"mappings":";;;;;AAgEA,eAAsB,UAAU,QAA0B;;AACxD,MAAI,OAAO,cAAc;AACjB,UAAA,IAAI,MAAM,mCAAmC;AACrD,MAAI,OAAO,WAAW,YAAmB,OAAA,IAAI,MAAM,qBAAqB;AACxE,QAAM,EAAE,QAAQ,QAAQ,SAAS,MAAU,IAAA;AAC3C,MAAI,OAAO,WAAW,YAAY,OAAO,WAAW,UAAU;AACtD,UAAA,IAAI,UAAU,qBAAqB;AAAA,EAAA;AAE3C,WACE,QAAQ;AAAA,IACN,oCAAoC,MAAM;AAAA,IAC1C;AAAA,IACA;AAAA,EACF;AAGI,QAAA,oBACJ,OAAO,YAAY,cACf,UACA,MAAM,YAAY,QAAQ,MAAM,EAAE,KAAK,aAAa;AAEtD,QAAA,uBAAkB,qBAAlB,mBAAoC,YAAW,GAAG;AAC3C,aAAA,QAAQ,KAAK,kCAAkC;AACjD,WAAA;AAAA,EAAA;AAGT,WACE,QAAQ;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAGF,QAAM,aAAa,MAAM,UAAU,YAChC,IAAI;AAAA,IACH,WAAW;AAAA,EAAA,CACZ,EAEA,KAAK,gBAAgB;AAExB,WACE,QAAQ;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAGK,SAAA,aAAa,QAAQ,UAAU;AACxC;"}