{"version":3,"file":"assertion.fetch.js","sources":["../src/assertion.fetch.ts"],"sourcesContent":["import {\n  INVALID_INPUT_MESSAGE,\n  INVALID_RESPONSE_MESSAGE,\n  isValidResponse,\n} from './errors.js';\nimport { DEFAULT_FETCH_OPTIONS } from './constants.js';\nimport { EncodedPublicKeyCredentialRequestOptions } from './assertion.encoder.js';\nimport { EncodedCredential } from './assertion.encoder.js';\n\n/**\n * Fetch Assertion Options\n *\n * POST Authenticator Selector to the REST API\n * to receive the PublicKeyCredentialRequestOptions\n *\n * @param origin\n * @param credId\n * @todo: Generate Typed JSON-RPC clients from Swagger/OpenAPI\n * @module fetch\n */\nexport async function postOptions(origin: string, credId: string) {\n  if (typeof origin !== 'string' || typeof credId !== 'string') {\n    throw new TypeError(INVALID_INPUT_MESSAGE);\n  }\n  return await fetch(`${origin}/assertion/request/${credId}`, {\n    ...DEFAULT_FETCH_OPTIONS,\n  }).then((r) => {\n    if (!isValidResponse(r)) {\n      throw new Error(INVALID_RESPONSE_MESSAGE);\n    }\n    return r.json() as Promise<EncodedPublicKeyCredentialRequestOptions>;\n  });\n}\n\n/**\n * Fetch Assertion Response\n *\n * POST an Authenticator Assertion Response to the REST API\n *\n * @param origin\n * @param credential\n * @todo: Generate Typed JSON-RPC clients from Swagger/OpenAPI\n */\nexport async function postResponse(\n  origin: string,\n  credential: EncodedCredential,\n) {\n  if (typeof origin !== 'string' || typeof credential !== 'object') {\n    // TODO: instance check for SerializedCredential\n    throw new TypeError(INVALID_INPUT_MESSAGE);\n  }\n  return await fetch(`${origin}/assertion/response`, {\n    ...DEFAULT_FETCH_OPTIONS,\n    body: JSON.stringify(credential),\n  }).then((r) => {\n    if (!isValidResponse(r)) {\n      throw new Error(INVALID_RESPONSE_MESSAGE);\n    }\n    return r.json();\n  });\n}\n"],"names":[],"mappings":";;AAoBsB,eAAA,YAAY,QAAgB,QAAgB;AAChE,MAAI,OAAO,WAAW,YAAY,OAAO,WAAW,UAAU;AACtD,UAAA,IAAI,UAAU,qBAAqB;AAAA,EAAA;AAE3C,SAAO,MAAM,MAAM,GAAG,MAAM,sBAAsB,MAAM,IAAI;AAAA,IAC1D,GAAG;AAAA,EAAA,CACJ,EAAE,KAAK,CAAC,MAAM;AACT,QAAA,CAAC,gBAAgB,CAAC,GAAG;AACjB,YAAA,IAAI,MAAM,wBAAwB;AAAA,IAAA;AAE1C,WAAO,EAAE,KAAK;AAAA,EAAA,CACf;AACH;AAWsB,eAAA,aACpB,QACA,YACA;AACA,MAAI,OAAO,WAAW,YAAY,OAAO,eAAe,UAAU;AAE1D,UAAA,IAAI,UAAU,qBAAqB;AAAA,EAAA;AAE3C,SAAO,MAAM,MAAM,GAAG,MAAM,uBAAuB;AAAA,IACjD,GAAG;AAAA,IACH,MAAM,KAAK,UAAU,UAAU;AAAA,EAAA,CAChC,EAAE,KAAK,CAAC,MAAM;AACT,QAAA,CAAC,gBAAgB,CAAC,GAAG;AACjB,YAAA,IAAI,MAAM,wBAAwB;AAAA,IAAA;AAE1C,WAAO,EAAE,KAAK;AAAA,EAAA,CACf;AACH;"}